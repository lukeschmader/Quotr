<!DOCTYPE html>
<html ng-app="stockApp">
  <head>
    <meta charset="utf-8">
    <title>Angular.js Example</title>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.1/angular.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
	<link href="css/myCss.css" rel="stylesheet">
	<script src="js/Chart.js"></script>
    <script>    
    
   
    var nameApp = angular.module('stockApp', []);
      nameApp.controller('StockCtrl', function ($scope, $http){	
    	  $scope.search="GPRO";
        $scope.$watch('search', function(newValue, oldValue){
        	if(newValue != "")
        	{   			  
	               refreshStock(newValue);  
	               refreshChart(newValue);
        	}
        	
        	
          });  
        function refreshChart(sym)
        {
        	
        	var ctx = document.getElementById("myChart").getContext("2d");
        	var data = {
        		    labels: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "Novemeber"],
        		    datasets: [
        		        {
        		            label: "My First dataset",
        		            fillColor: "rgba(220,220,220,0.2)",
        		            strokeColor: "#676767",
        		            pointColor: "#676767",
        		            pointStrokeColor: "#fff",
        		            pointHighlightFill: "#fff",
        		            pointHighlightStroke: "rgba(220,220,220,1)",
        		            data: [65, 59, 80, 81, 56, 55, 40, 60, 70, 80, 100, 95]
        		        }
        		    ]
        		};
        	
        	
        	new Chart(ctx).Line(data, {
        	    bezierCurve: false,
        	    pointDot : false,
        	    animation: false
        	});
        	$scope.$apply();
        }
        
        function refreshStock(sym)
        {
        	var urls = '/StockWebApp/StockServlet?symbol=' + angular.uppercase(sym);
            $scope.search=angular.uppercase($scope.search);
            $http.get(urls).success(function(data){
            	if(data != "")
        		{
	            	var J =  data;		            	
		            //Headings	            
		            document.getElementById("companyName").innerHTML = J.data.company.name;
		            document.getElementById("symbol").innerHTML = " (" + J.data.company.symbol + ") ";
		            document.getElementById("pctChg").innerHTML = J.data.stock.pctChg < 0.00 ? "<font color=red>" + "(" +J.data.stock.pctChg + "%)" + "</font>" 
		            		: "<font color=green>" + "(+" + J.data.stock.pctChg + "%)" + "</font>";   
		            //Table
		            document.getElementById("price").innerHTML =J.data.stock.price;	
		            document.getElementById("change").innerHTML =J.data.stock.change;
		            document.getElementById("dayLow").innerHTML =J.data.stock.dayLow;
		            document.getElementById("dayHigh").innerHTML =J.data.stock.dayHigh;
		            document.getElementById("ask").innerHTML =J.data.stock.ask;
		            document.getElementById("bid").innerHTML =J.data.stock.bid;
		            document.getElementById("chgFromYearLowPct").innerHTML =J.data.stock.chgFromYearLowPct;
		            document.getElementById("chgFromYearHighPct").innerHTML =J.data.stock.chgFromYearHighPct;
		            document.getElementById("eps").innerHTML =J.data.stock.eps;
		            document.getElementById("peg").innerHTML =J.data.stock.peg;
		            
		            
        		}
            	$scope.$apply();
            });	 
        }
        
        setInterval(function(){ refreshStock($scope.search); }, 3000);
      }); 
      
     
      
      
    </script>
  </head>

  <body ng-controller="StockCtrl">
   <div class="container">
 	 <div class="row">
		<div class="h3 darkBG col-md-12">Stock App</div>
	</div>
	<div class="row">
		<div class="col-md-9">				
		</div>
		<div class="col-md-3">
		Search:<input ng-model="search" placeholder="Search symbol..." ng-model-options="{debounce: 1000}" type="text"/><br><br><br>
		</div>
	</div> 
	<div class="row">
	<div class="col-xl-12">
	    <h2 id="companyName"></h2>
	    <h2 id="symbol"></h2>
	    <h2 id="pctChg"></h2>
    </div>
    <div class="row">
    <div class="col-sm-8">
    		<canvas id="myChart" width="800" height="300"></canvas>
    </div>
	    <div class="col-sm-2">    
		    <table class=" table">
		    <thead>
		    <tr>
		        <th></th>
		        <th></th>
		      </tr>		      
		    </thead>
		    <tbody>
		      <tr>
		        <td><font color=grey>Price</font></td>
		        <td id="price"></td>
		      </tr>
		      <tr>
		        <td><font color=grey>Day low</font></td>
		        <td id="dayLow"></td>
		      </tr>
		      <tr>
		        <td><font color=grey>Ask</font></td>
		        <td id="ask"></td>
		      </tr>
		      <tr>
		        <td><font color=grey>% yr low</font></td>
		        <td id ="chgFromYearLowPct"></td>
		      </tr>
		      <tr>
		        <td><font color=grey>EPS</font></td>
		        <td id="eps"></td>		        
		      </tr>
		    </tbody>
		  </table>
	  	</div>
	  	 <div class="col-sm-2">    
		    <table class=" table">
		    <thead>
		    <tr>
		        <th></th>
		        <th></th>
		      </tr>		      
		    </thead>
		    <tbody>
		      <tr>
		        <td><font color=grey>Change</font></td>
		        <td id="change"></td>
		      </tr>
		      <tr>
		        <td><font color=grey>Day high</font></td>
		        <td id="dayHigh"></td>
		      </tr>
		      <tr>
		        <td><font color=grey>Bid</font></td>
		        <td id="bid"></td>
		      </tr>
		      <tr>
		        <td><font color=grey>% yr high</font></td>
		        <td id="chgFromYearHighPct"></td>
		      </tr>
		      <tr>
		        <td><font color=grey>PEG</font></td>
		        <td id="peg"></td>
		      </tr>
		    </tbody>
		  </table>
	  	</div>
    </div>
    <br>
    <br>
  </div>  
</div>
  </body>
</html>